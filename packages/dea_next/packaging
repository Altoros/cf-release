set -e -x

cp -a dea_next/* ${BOSH_INSTALL_TARGET}
if [ "`uname -m`" == "ppc64le" ]; then
  # the nokogiri gem from rubygems.org is not installing
  tar xvfz dea_next_gems/dea_next_gems_vendor_cache.tar.gz -C ${BOSH_INSTALL_TARGET}
fi

cd ${BOSH_INSTALL_TARGET}
/var/vcap/packages/ruby-2.1.4/bin/bundle install --local --deployment --without=development test

if [ "`uname -m`" == "ppc64le" ]; then
  export GOROOT=$(readlink -nf /var/vcap/packages/gccgo/gccgo)
  export LD_LIBRARY_PATH=$GOROOT/lib64
else
export GOROOT=$(readlink -nf /var/vcap/packages/golang1.3)
fi

export PATH=$GOROOT/bin:$PATH

export GOPATH=${BOSH_INSTALL_TARGET}/go

cd $GOPATH
go install runner

