set -e -x

REPO_NAME=github.com/cloudfoundry/gorouter

REPO_DIR=${BOSH_INSTALL_TARGET}/src/${REPO_NAME}

mkdir -p $(dirname $REPO_DIR)

cp -a $(basename $REPO_NAME)/ $REPO_DIR

if [ "`uname -m`" == "ppc64le" ]; then
  export GOROOT=$(readlink -nf /var/vcap/packages/gccgo/gccgo)
  export LD_LIBRARY_PATH=$GOROOT/lib64
  ln -s $GOROOT /usr/local/gccgo
  mkdir -p $BOSH_INSTALL_TARGET/lib
  cp $GOROOT/lib64/libgo.so.7.0.0 $BOSH_INSTALL_TARGET/lib/libgo.so.7
else
  export GOROOT=$(readlink -nf /var/vcap/packages/golang1.4)
fi

export GOPATH=$BOSH_INSTALL_TARGET:${REPO_DIR}/Godeps/_workspace
export PATH=$GOROOT/bin:$PATH

go install ${REPO_NAME}
