set -e -x

REPO_NAME=github.com/cloudfoundry/gorouter

REPO_DIR=${BOSH_INSTALL_TARGET}/src/${REPO_NAME}

mkdir -p $(dirname $REPO_DIR)

cp -a $(basename $REPO_NAME)/ $REPO_DIR

if [ "`uname -m`" == "ppc64le" ]; then
  export GOROOT=$(readlink -nf /var/vcap/packages/gccgo/gccgo)
  export LD_LIBRARY_PATH=$GOROOT/lib64
  export GOPATH=$BOSH_INSTALL_TARGET
  ln -s $GOROOT /usr/local/gccgo
else
  export GOROOT=$(readlink -nf /var/vcap/packages/golang1.4)
  export GOPATH=$BOSH_INSTALL_TARGET:${REPO_DIR}/Godeps/_workspace
fi

export PATH=$GOROOT/bin:$PATH

go install ${REPO_NAME}
